<%- include('./mainpage/headerAndNav') %>

  <body>
    <div class="container navTopMargin">
      <div class="row">
        <div class="col-sm-4 h-auto d-flex align-items-stretch bg-info ">
            <div class="card-body">
              <h5 class="card-title"><h5><%= selectedEpisode.name %></h5>
              <p class="card-text"></p>
              <form class="artworkDisplay d-flex justify-content-center">
                <img class='seriesArtwork w-auto'src="/<%=selectedEpisode.artwork_filename%>"/>
                <button class= "mx-auto" type='submit' formaction="/podcast/episode/<%=selectedEpisode.id%>">Play</button>
                <input type='hidden'  name="podcast_ext_url" value="<%=selectedEpisode.podcast_ext_url%>"/>
              </form>
          </div>
        </div>
        <div class="col-sm-8 bg-warning">          
          <div class="card-body">
            <div class ="w-100 d-inline-flex justify-content-between">
              <div class="dropdown" >                  
                <button class="btn bg-transparent text-dark dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class='episodeDescription'>Description</span>
                </button>                  
                  <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" href="/podcast/episode/<%=selectedEpisode.id%>/edit" class="btn btn-warning" role="button">Edit</a> 
                    <form class="dropdown-item" action="/podcast/episode/<%=selectedEpisode.id%>/delete?_method=DELETE" method="POST">
                      <input
                        type="submit"
                        name="_method"
                        class="btn btn-danger"
                        value="Delete"
                      />
                    </form>                    
                </div>
              </div>
            <div class="align-self-center">
              <form action='/podcast/episode/<%=selectedEpisode.id%>/favourite' method="POST">
                <button class="favouriteBtn bg-transparent border-0 shadow-none"                             
                type="submit"
                <% if(!locals.loggedInUser) {%>
                  disabled
                <% } %>
                >
                  <% if(locals.isEpisodeFavourited !== undefined) { %>
                    <% if(isEpisodeFavourited === true ){ %>
                    <i class="fa fa-heart"></i>
                    <% } else if(isEpisodeFavourited === false) { %>
                    <i class="fa fa-heart-o"></i>
                    <% } %>
                  <% } else { %>
                    <i class="fa fa-heart-o"></i>
                  <% } %>
                </button>              
                <input type="hidden" name="favouriteSeries"/>                              
              </form>
            </div>
          </div>
        </div>
          <p class="card-text ml-3"><%=selectedEpisode.description%></p>
        </div>
      </div>
    </div>
    <div class="container">
      <div class='mt-4 mb-2'>Comments</div>
      <form action="/podcast/episode/<%=selectedEpisode.id%>/comment" method="POST">
      <div class="row">
        <div class="col">
          <div class="form-group">
            <textarea class="form-control commentBox" rows="1" id="comment" name="comment" placeholder='Add a public comment'></textarea>
            <% if(!locals.loggedInUser){%>
            <small class= 'text-danger' >You must be logged in to favourite or make a comment.</small>
            <% } %>
          </div>
        </div>
      </div>

      <div class="form-group pl-3">
          <div class="row">
            <div class="col-xs-1">
                <button class="btn btn-primary btn-sm" type="submit" role="button"
                <% if(!locals.loggedInUser) { %>
                disabled                
                <% } %>>
                  Submit
                </button>
            </div>
          <div class="col-xs-1">
            <a href="/podcast/episode<%=selectedEpisode.id%>" class="btn btn-outline-secondary btn-sm ml-3" role="button">
                  Cancel</a
                >
            </div>
          </div>
        </div>
       </form>
    </div>
  </div>

<!-- Comments display -->
  <div class="container">
    <%if (locals.comments) {%>
    <% comments.forEach((comment)=>{ %>
    <div class="row">
      <div class="col-sm-2 mb-3 d-flex justify-content-end align-self-start mt-1 pr-2">
         <a href='/user/<%=comment.poster_id%>'>
          <img class="profilePic rounded-circle" src='/<%=comment.profile_pic%>'>
        </a>
      </div>
      <div class="col-sm-10 mb-3">
        <div class="row">
          <div class="col-md-4 pl-0">
            <a href='/user/<%=comment.poster_id%>'>
              <small class="commentsDisplay"><b><%=comment.username%></b></small>
            </a>
          </div>
        </div>
          <div class="row">
            <div class="col-md-4 pl-0">
              <small class='commentsDisplay'><%=comment.comment%></small>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4 pl-0">
              <small class='commentsDisplay'>
                <form action='/podcast/episode/<%=selectedEpisode.id%>/comment/<%=comment.user_episode_comment_id%>/favourite?_method=PUT' method="POST" >
                <button class="bg-transparent border-0 shadow-none commentFavouriteBtn" type="submit">
                  <% if(comment.isFavourited !== undefined){ %>
                    <% if(comment.isFavourited === true) { %>
                      <i class="fa fa-heart"></i>
                    <% } else { %>
                      <i class="fa fa-heart-o"></i>
                    <% } %>
                  <% } else { %>
                  <i class="fa fa-heart-o"></i>
                  <% } %>
                </button>
                <input type="hidden" name="favouriteComment"/>
                </form>
              </small>
            </div>
          </div>          
        </div>
      </div>
    <% }); %>
    <% } %>
  </div>
  
  <div class="container">
      <div class="row mt-3 pb-4 navTopMargin">
        <div class="col d-flex justify-content-center ">
          <a href="/" class="btn btn-primary" role="button">
            Return to Main</a
          >
        </div>
    </div>
  </div>
  </body>
<%-include('soundcloudPlayer') %>
<%-include('./mainpage/footer') %>
